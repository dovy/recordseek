"use strict";var RecordSeek=RecordSeek||{};RecordSeek.helpers={isNotString:function(a){return"string"!=typeof a}},"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){FastClick.attach(document.body)},!1),angular.module("recordseekApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]).run(["$rootScope","$location","$cookies","$window","fsAPI",function(a,b,c,d,e){a.helpers=RecordSeek.helpers,a.attachMsg="This source was created for free with http://RecordSeek.com",a.debug="http://localhost:9000"!==document.location.origin?!1:!0,a.debug||(ga("create","UA-16096334-10"),ga("send","pageview")),a.service="",a.log=function(b){a.debug&&console.log(b)},a.track=function(b){a.debug?a.log(b):ga("send","event",b)},a.actionTaken=function(c){var e=c.currentTarget.attributes;e["data-tracking"]&&a.track({eventCategory:"App",eventAction:e["data-tracking"].value}),e.target&&"_blank"===e.target.value?d.open(e["data-href"].value):b.path(e["data-href"].value)},a.expires=15,window.liveSettings={api_key:"11643e1c6ccd4371bfb889827b19fde3",picker:"#languagePicker",detectlang:!0,dynamic:!0,autocollect:!0,staging:!0};var f=e.helpers.decodeQueryString(document.URL);if(b.$$absUrl.indexOf("?_")>-1&&-1===b.$$absUrl.indexOf("/#"),a.sourceBoxURL="https://familysearch.org/links-gadget/linkpage.jsp?referrer=/links-gadget/linkpage.jsp#sbp",f){var g=f;for(var h in g){var i=g[h],j=typeof i;null!==i&&"string"===j&&g.hasOwnProperty(h)&&(g[h]=g[h].trim())}a.data=g,a.data.sourceFormat||(a.data.sourceFormat="MLA");var k="/Date("+a.data._+")/",l=new Date(parseFloat(k.substr(6))),m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=l.getFullYear(),o=m[l.getMonth()],p=l.getDate();if(a.data.time=p+" "+o+". "+n,a.data.url&&""!==a.data.url){if(a.data.url.indexOf("ancestry")>-1&&(a.data.url=a.data.url.replace("ancestryinstitution.com","ancestry.com").replace("ancestrylibrary.com","ancestry.com").replace("ancestrylibrary.proquest.com","ancestry.com")),a.data.url.indexOf("billiongraves.com")>-1){var q=a.data.url.split("/");a.data.citation='"Billion Graves Record," BillionGraves ('+a.data.url+" accessed ".$rootScope.data.time+"), ".$rootScope.data.description+" Record #"+q[q.length-1]+". Citing BillionGraves, Headstones, BillionGraves.com."}else a.data.citation||(a.data.citation='"'+a.data.title+'." '+a.data.title+". N.p., n.d. Web. "+a.data.time+". <"+a.data.url+">.");var r=a.data.url.split("//"),s=r[1];r=s.split("/"),a.data.domain=r[0].charAt(0).toUpperCase()+r[0].slice(1),a.track({eventCategory:"Domain",eventAction:a.data.domain.toLowerCase().replace("www.","")})}a.data.notes&&""!==a.data.notes.trim()?a.data.notes+="\n\n":a.data.notes="",a.data.notes+=a.attachMsg,a.data.title||(a.data.title=""),a.data.citation||(a.data.citation="")}else"http://recordseek.com"===document.location.origin||"https://recordseek.com"===document.location.origin||a.data||(a.data=angular.fromJson(c.get("recordseek")));a.$on("$routeChangeSuccess",function(){if("http://recordseek.com"!==document.location.origin&&"https://recordseek.com"!==document.location.origin&&a.data&&"/about"!==b.$$path&&"/support"!==b.$$path&&"/expired"!==b.$$path&&a.data){var d=new Date,e=new Date(d);e.setMinutes(d.getMinutes()+a.expires),c.put("recordseek",angular.toJson(a.data),{expires:e})}}),a.data||(a.data={}),a.auth={};var t="";a.resetSearch=function(){a.data.search&&a.data.search.advanced&&(t=a.data.search.advanced),a.data.search={givenName:"",givenNameExact:"",surname:"",surnameExact:"",gender:"",eventType:"",eventDate:"",eventDateFrom:"",eventDateTo:"",eventPlace:"",eventPlaceExact:"",spouseGivenName:"",spouseGivenNameExact:"",spouseSurname:"",spouseSurnameExact:"",motherGivenName:"",motherGivenNameExact:"",motherSurname:"",motherSurnameExact:"",fatherGivenName:"",fatherGivenNameExact:"",fatherSurname:"",fatherSurnameExact:"",pid:""},""!==t&&(a.data.search.advanced=t)},a.data.search||(a.resetSearch(),a.data.search.advanced=!1)}]).constant("_",_).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/loading",{templateUrl:"views/loading.html",controller:"LoadingCtrl"}).when("/support",{templateUrl:"views/support.html",controller:"SupportCtrl"}).when("/fs-source",{templateUrl:"views/fs-source.html",controller:"FsSourceCtrl"}).when("/fs-upload",{templateUrl:"views/fs-upload.html",controller:"FsUploadCtrl"}).when("/fs-search",{templateUrl:"views/fs-search.html",controller:"FsSearchCtrl"}).when("/fs-addPerson",{templateUrl:"views/fs-addperson.html",controller:"FsAddpersonCtrl"}).when("/fs-attach",{templateUrl:"views/fs-attach.html",controller:"FsAttachCtrl"}).when("/fs-complete",{templateUrl:"views/fs-complete.html",controller:"FsCompleteCtrl"}).when("/a-source",{templateUrl:"views/a-source.html",controller:"ASourceCtrl"}).when("/fs-results",{templateUrl:"views/fs-results.html",controller:"FsResultsCtrl"}).when("/fs-create",{templateUrl:"views/fs-create.html",controller:"FsCreateCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("recordseekApp").controller("MainCtrl",["$scope","$rootScope",function(a,b){b.service=""}]);var init=function(){var a=800,b=675;window.resizeTo(a,b),window.moveTo(screen.width-a,(screen.height-b)/2)};angular.module("recordseekApp").controller("LoadingCtrl",["$rootScope",function(a){a.service=""}]),angular.module("recordseekApp").controller("AboutCtrl",["$rootScope",function(a){a.service=""}]),angular.module("recordseekApp").controller("SupportCtrl",["$rootScope",function(a){a.service=""}]),angular.module("recordseekApp").controller("FsSourceCtrl",["$cookies","$rootScope","$location","$scope","fsAPI",function(a,b,c,d,e){b.service="FamilySearch",e.getCurrentUser().then(function(a){b.fsUser=a.getUser()}),d.origSource=b.data.citation,d.goNext=function(){c.path("/fs-search"),d.origSource!==b.data.citation&&b.track({eventCategory:"FamilySearch",eventAction:"Citation",eventLabel:"Modified"})},d.goBack=function(){b.service="",c.path("/")},d.goUpload=function(){c.path("/fs-upload")},d.createNow=function(){b.track({eventCategory:"FamilySearch",eventAction:"Create",eventLabel:"Now"}),c.path("/fs-create")}}]),angular.module("recordseekApp").controller("FsUploadCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("recordseekApp").controller("FsSearchCtrl",["$rootScope","$location","$scope","fsAPI","fsUtils",function(a,b,c,d,e){a.service="FamilySearch",d.getCurrentUser().then(function(b){a.fsUser=b.getUser()}),a.data.search.advanced?c.advancedButtonText="Basic":c.advancedButtonText="Advanced",c.getLocation=e.getLocation,c.removeEmpty=e.removeEmptyProperties,c.advancedSearch=function(){a.data.search.advanced?(a.data.search.advanced=!1,c.advancedButtonText="Advanced"):(c.advancedButtonText="Basic",a.data.search.advanced=!0)},c.goNext=function(){b.path("/fs-results")},c.goBack=function(){b.path("/fs-source")}}]),angular.module("recordseekApp").controller("FsAddpersonCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("recordseekApp").controller("FsAttachCtrl",["$rootScope","$location","$scope","fsAPI",function(a,b,c,d){a.service="FamilySearch",d.getCurrentUser().then(function(b){a.fsUser=b.getUser()}),a.data.attach||(a.data.search?b.path("/fs-results"):b.path("/fs-search")),a.data.attach.justification||(a.data.attach.justification=""),c.goBack=function(){b.path("/fs-results")},c.goNext=function(){b.path("/fs-create")}}]),angular.module("recordseekApp").controller("FsCompleteCtrl",["fsAPI","$rootScope","$scope","$location",function(a,b,c,d){b.service="FamilySearch",c.goSearch=function(){d.path("/fs-search")}}]),angular.module("recordseekApp").provider("fsAPI",["_",function(){this.environment="sandbox","http://localhost:9000"!==document.location.origin&&(this.environment="production"),"http://recordseeknew.dev"===document.location.origin||"https://recordseeknew.dev"===document.location.origin,"sandbox"===this.environment?this.client_id="a0T3000000ByxnUEAR":this.client_id="S1M9-QH77-ZGJK-2HB1-MYZZ-6YN9-SBNQ-6YPS",this.redirect_uri=document.location.origin,"http://localhost:9000"!==document.location.origin&&(this.redirect_uri+="/share/"),this.$get=["$window","$http","$q","$timeout","$rootScope","$injector","$location",function(a,b,c,d,e,f,g){if(this.client_id&&this.environment&&this.redirect_uri&&(this.FamilySearch=new FamilySearch({client_id:this.client_id,environment:this.environment,redirect_uri:this.redirect_uri,http_function:b,deferred_function:c.defer,save_access_token:!0,auto_expire:!0,timeout_function:d,expire_callback:function(a){var b=a.helpers.decodeQueryString(document.URL);(!b||b&&!b.code&&!b.state)&&a.getOAuth2AuthorizeURL(window.location.href).then(function(a){window.location=a})}}),this.urlParams=this.FamilySearch.helpers.decodeQueryString(document.URL),this.urlParams.code&&this.urlParams.state)){e.status="Authenticating, please wait.",g.path("/loading");var h=this.urlParams.state.split("#");h=h[0]+="#/fs-source",this.FamilySearch.getAccessToken(this.urlParams.code).then(function(){window.location=h})}return this.FamilySearch}]}]),angular.module("recordseekApp").factory("fsUtils",["_","$q","fsAPI","$rootScope",function(a,b,c,d){return{removeEmptyProperties:function(b){return a.omit(b,function(b){return a.isEmpty(b)&&0!==b})},getPrimaryPerson:function(a){return{pid:a.id,name:a.$getDisplayName(),birthDate:a.$getBirthDate(),gender:a.$getDisplayGender(),url:a.$getPersistentIdentifier(),birthPlace:a.$getBirthPlace(),deathDate:a.$getDeathDate(),deathPlace:a.$getDeathPlace()}},getLocation:function(){return c.getPlaceSearch(d.data.search.eventPlace,{count:"10"}).then(function(a){var b=a.getPlaces(),c=[];return angular.forEach(b,function(a){c.length<9&&this.push(a.$getNormalizedPlace())},c),c})}}}]),angular.module("recordseekApp").controller("ASourceCtrl",["$rootScope","$location","$scope","$window","$cookies",function(a,b,c,d,e){a.service="Ancestry",c.goNext=function(){a.debug&&e.remove("recordseek");var b="http://trees.ancestry.com/savetoancestry?o_sch=Web+Property";a.data.url&&(b+="&url="+encodeURIComponent(a.data.url)),a.data.domain&&(b+="&domain="+encodeURIComponent(a.data.domain)),a.data.title&&(b+="&collection="+encodeURIComponent(a.data.title)),a.data.citation&&(b+="&details="+encodeURIComponent(a.data.citation)),a.track({eventCategory:"Ancestry",eventAction:"Source",eventLabel:b}),d.location.href=b},c.goBack=function(){a.service="",b.path("/")}}]),angular.module("recordseekApp").controller("FsResultsCtrl",["$rootScope","$location","$scope","fsAPI","fsUtils",function(a,b,c,d,e){a.service="FamilySearch",c.goBack=function(){a.track({eventCategory:"FamilySearch",eventAction:"Search",eventLabel:"Refine"}),b.path("/fs-search")},c.goNext=function(c,d,e){a.track({eventCategory:"FamilySearch",eventAction:"Selected",eventLabel:c}),a.data.attach={pid:c,name:d,url:e,justification:""},b.path("/fs-attach")},c.pageChanged=function(){delete c.searchResults,c.getResults()},c.getResults=function(){function f(a){for(var b=[],c=0,d=a.length;d>c;c++)a[c].living||b.push({pid:a[c].id,url:a[c].$getPersistentIdentifier(),name:a[c].$getDisplayName(),gender:a[c].$getDisplayGender(),data:a[c]});return b}var g=angular.copy(a.data.search);g.eventDate="",g.eventType&&(g.eventDateFrom&&""!==g.eventDateFrom?(g.eventDate+=g.eventDateFrom,g.eventDateTo&&""!==g.eventDateTo&&g.eventDateFrom!==g.eventDateTo&&(g.eventDate+="-"+g.eventDateTo)):g.eventDateTo&&""!==g.eventDateTo&&(g.eventDate=g.eventDateTo),g[g.eventType+"Place"]=g.eventPlace,g[g.eventType+"Date"]=String(g.eventDate)+"~"),g.advanced===!0?(g.givenName+="1"!==g.givenNameExact&&""!==g.givenName?"~":"",g.surname+="1"!==g.surnameExact&&""!==g.surname?"~":"",g.spouseGivenName+="1"!==g.spouseGivenNameExact&&""!==g.spouseGivenName?"~":"",g.spouseSurname+="1"!==g.spouseSurnameExact&&""!==g.spouseSurname?"~":"",g.fatherGivenName+="1"!==g.fatherGivenNameExact&&""!==g.fatherGivenName?"~":"",g.fatherSurname+="1"!==g.fatherSurnameExact&&""!==g.fatherSurname?"~":"",g.motherGivenName+="1"!==g.motherGivenNameExact&&""!==g.motherGivenName?"~":"",g.motherSurname+="1"!==g.motherSurnameExact&&""!==g.motherSurname?"~":"",g.eventPlace+="1"!==g.eventPlaceExact&&""!==g.eventPlace?"~":""):(g.givenName=""!==g.givenName?g.givenName+"~":"",g.surname=""!==g.surname?g.surname+"~":"",g.spouseGivenName=""!==g.spouseGivenName?g.spouseGivenName+"~":"",g.spouseSurname=""!==g.spouseSurname?g.spouseSurname+"~":"",g.fatherGivenName=""!==g.fatherGivenName?g.fatherGivenName+"~":"",g.fatherSurname=""!==g.fatherSurname?g.fatherSurname+"~":"",g.motherGivenName=""!==g.motherGivenName?g.motherGivenName+"~":"",g.motherSurname=""!==g.motherSurname?g.motherSurname+"~":"",g.eventPlace=""!==g.eventPlace?g.eventPlace+"~":""),delete g.eventType,delete g.eventDate,delete g.eventDateFrom,delete g.eventDateTo,delete g.eventPlace,delete g.advanced,delete g.givenNameExact,delete g.surnameExact,delete g.spouseGivenNameExact,delete g.spouseSurnameExact,delete g.fatherGivenNameExact,delete g.fatherSurnameExact,delete g.motherGivenNameExact,delete g.motherSurnameExact,delete g.eventPlaceExact,g=e.removeEmptyProperties(g),0===Object.keys(g).length&&b.path("/fs-search"),c.context&&(g.context=c.context),c.min=15*c.currentPage-14,c.max=15*c.currentPage,c.min<1&&(c.min=1),c.bigTotalItems&&c.max>c.bigTotalItems&&(c.max=c.bigTotalItems),c.maxSize=5,c.bigTotalItems=0,c.index=0,c.max=0,g.pid&&""!==g.pid?d.getPersonWithRelationships(g.pid,{persons:!0}).then(function(a){c.searchResults=[];var b=a.getPrimaryPerson();if(b){c.bigTotalItems=c.max=1;var d=e.getPrimaryPerson(b);d.confidence=5,d.father=f(a.getFathers()),d.mother=f(a.getMothers()),d.spouse=f(a.getSpouses()),d.children=f(a.getChildren()),c.searchResults.push(d)}}):d.getPersonSearch(g).then(function(b){c.searchResults=[];var d=b.getSearchResults();c.bigTotalItems=b.getResultsCount(),c.index=b.getIndex(),c.max>c.bigTotalItems&&(c.max=c.bigTotalItems),a.log("Record length: "+d.length);for(var g=0,h=d.length;h>g;g++){var i=d[g],j=i.$getPrimaryPerson(),k=e.getPrimaryPerson(j);k.confidence=d[g].confidence,k.father=f(i.$getFathers()),k.mother=f(i.$getMothers()),k.spouse=f(i.$getSpouses()),k.children=f(i.$getChildren()),c.searchResults.push(k)}a.log(c.searchResults),a.track({eventCategory:"FamilySearch",eventAction:"Search",eventLabel:"Results",eventValue:d.length})})},c.currentPage=1,c.getResults()}]),angular.module("recordseekApp").directive("resize",["$window",function(a){return function(b){var c=angular.element(a);b.$watch(function(){return{h:c.height(),w:c.width()}},function(a){b.windowHeight=a.h,b.windowWidth=a.w,b.style=function(){return{height:a.h-100+"px",width:a.w-100+"px"}}},!0),c.bind("resize",function(){b.$apply()})}}]),angular.module("recordseekApp").controller("FsCreateCtrl",["fsAPI","$rootScope","$scope","$location","fsUtils",function(a,b,c,d,e){function f(){b.data.sourceDescription&&(b.data.attach||(b.data.complete="noAttachment",delete b.data.attach,d.path("/fs-complete"))),delete b.data.complete,c.status="Attaching Source to "+b.data.attach.name,a.createSourceRef({$personId:b.data.attach.pid,$sourceDescription:b.data.sourceDescription}).$save(b.data.attach.justification).then(function(a){b.track({eventCategory:"FamilySearch",eventAction:"Source Attached",eventLabel:a}),b.data.complete=b.data.attach,b.data.complete.sourceRef=a,delete b.data.attach,d.path("/fs-complete")})}b.service="FamilySearch",a.getCurrentUser().then(function(a){b.fsUser=a.getUser()}),!b.data.sourceDescription&&b.data.url?(c.status="Generating Source",b.log(e.removeEmptyProperties({about:b.data.url.trim()?b.data.url.trim():"",citation:b.data.citation.trim()?b.data.citation.trim():"",title:b.data.title.trim()?b.data.title.trim():"",text:b.data.notes.trim()?b.data.notes.trim():""})),a.createSourceDescription(e.removeEmptyProperties({about:b.data.url.trim()?b.data.url.trim():"",$citation:b.data.citation.trim()?b.data.citation.trim():"",$title:b.data.title.trim()?b.data.title.trim():"",$text:b.data.notes.trim()?b.data.notes.trim():""})).$save(b.attachMsg).then(function(a){b.data.sourceDescription=a,b.track({eventCategory:"FamilySearch",eventAction:"Source Created",eventLabel:b.data.sourceDescription.id}),f()})):(b.track({eventCategory:"FamilySearch",eventAction:"Source Attached to Another"}),f())}]);