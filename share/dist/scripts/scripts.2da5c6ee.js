"use strict";angular.module("recordseekApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]).run(["$rootScope","$location","$cookies","$window",function(a,b,c,d){if(a.debug=!1,a.service="",a.expires=15,b.$$absUrl.indexOf("?_")>-1&&-1==b.$$absUrl.indexOf("/#")){var e=b.$$absUrl.replace("?_","#/?_");return void(d.location.href=e)}if(b.$$search&&b.$$search.url){var f=b.$$search;for(var g in f){var h=f[g],i=typeof h;null!==h&&"string"===i&&f.hasOwnProperty(g)&&(f[g]=f[g].trim())}a.data=f;var j="/Date("+a.data._+")/",k=new Date(parseFloat(j.substr(6))),l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m=k.getFullYear(),n=l[k.getMonth()],o=k.getDate();if(a.data.time=o+" "+n+". "+m,a.data.url&&""!==a.data.url){if(a.data.url.indexOf("ancestry")>-1&&(a.data.url=a.data.url.replace("ancestryinstitution.com","ancestry.com").replace("ancestrylibrary.com","ancestry.com").replace("ancestrylibrary.proquest.com","ancestry.com")),a.data.url.indexOf("billiongraves.com")>-1){var p=a.data.url.split("/");a.data.citation='"Billion Graves Record," BillionGraves ('+a.data.url+" accessed ".$rootScope.data.time+"), ".$rootScope.data.description+" Record #"+p[p.length-1]+". Citing BillionGraves, Headstones, BillionGraves.com."}else a.data.citation||(a.data.citation='"'+a.data.title+'." '+a.data.title+". N.p., n.d. Web. "+a.data.time+".<"+a.data.url+">.");var q=a.data.url.split("//"),r=q[1];q=r.split("/"),a.data.domain=q[0].charAt(0).toUpperCase()+q[0].slice(1)}a.data.notes?a.data.notes+="\n\n":a.data.notes="",a.data.notes+="This source was created for free with http://RecordSeek.com.",a.data.title||(a.data.title=""),a.data.citation||(a.data.citation=""),a.data.notes||(a.data.notes=""),b.url(b.path())}else a.data||(a.data=angular.fromJson(c.get("recordseek")));a.$on("$routeChangeSuccess",function(d,e,f){if(a.data&&"/about"!==b.$$path&&"/support"!==b.$$path&&"/expired"!==b.$$path&&a.data){var g=new Date,h=new Date(g);h.setMinutes(g.getMinutes()+a.expires),c.put("recordseek",angular.toJson(a.data),{expires:h})}}),a.auth={}}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/support",{templateUrl:"views/support.html",controller:"SupportCtrl"}).when("/fs-source",{templateUrl:"views/fs-source.html",controller:"FsSourceCtrl"}).when("/fs-upload",{templateUrl:"views/fs-upload.html",controller:"FsUploadCtrl"}).when("/fs-search",{templateUrl:"views/fs-search.html",controller:"FsSearchCtrl"}).when("/fs-addPerson",{templateUrl:"views/fs-addperson.html",controller:"FsAddpersonCtrl"}).when("/fs-attach",{templateUrl:"views/fs-attach.html",controller:"FsAttachCtrl"}).when("/fs-complete",{templateUrl:"views/fs-complete.html",controller:"FsCompleteCtrl"}).when("/a-source",{templateUrl:"views/a-source.html",controller:"ASourceCtrl"}).when("/fs-results",{templateUrl:"views/fs-results.html",controller:"FsResultsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("recordseekApp").controller("MainCtrl",["$scope","$rootScope",function(a,b){b.service=""}]),angular.module("recordseekApp").controller("AboutCtrl",["$rootScope",function(a){a.service=""}]),angular.module("recordseekApp").controller("SupportCtrl",["$rootScope",function(a){a.service=""}]),angular.module("recordseekApp").controller("FsSourceCtrl",["$cookies","$rootScope","$location","$scope","fsAPI","fsCurrentUserCache",function(a,b,c,d,e,f){b.service="FamilySearch",d.goNext=function(){c.path("/fs-search")},d.goBack=function(){b.service="",c.path("/")},d.goUpload=function(){c.path("/fs-upload")},b.auth.familysearch||(d.busy=!0,f.getUser().then(function(a){e.getCollectionsForUser(a.id).then(function(a){console.log(a.getCollections())})}),e.getAccessToken().then(function(){b.$emit("newSession"),f.getUser().then(function(a){b.data.boxes||e.getCollectionsForUser(a.id).then(function(a){var b=a.getCollections();a.getCollections(function(a){console.log(a)});var c=[];angular.forEach(b,function(a,b){""!=b.title&&this.push(b.id+": "+b.title)},c),console.log(c),console.log(b)}),b.auth.familysearch=a})}))}]),angular.module("recordseekApp").controller("FsUploadCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("recordseekApp").controller("FsSearchCtrl",["$rootScope","$location","$scope",function(a,b,c){a.service="FamilySearch",a.search||(a.search={surname:"",gender:"",eventType:"",spouseGiven:"",spouseSurname:"",eventDate:"",eventPlace:"",motherGiven:"",motherSurname:"",fatherGiven:"",fatherSurname:"",pid:""}),c.goNext=function(){b.path("/fs-results")},c.goBack=function(){b.path("/fs-source")}}]),angular.module("recordseekApp").controller("FsAddpersonCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("recordseekApp").controller("FsAttachCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("recordseekApp").controller("FsCompleteCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("recordseekApp").provider("fsAPI",function(){var a="WCQY-7J1Q-GKVV-7DNM-SQ5M-9Q5H-JX3H-CMJK",b="beta",c="http://localhost:9000/#!/auth";this.authToken="",this.setClientId=function(b){return a=b,this},this.setEnvironmentName=function(a){return b=a,this},this.setRedirectUri=function(a){return c=a,this},this.$get=["$window","$http","$q","$timeout","$rootScope",function(d,e,f,g,h){return a&&b&&c&&d.FamilySearch.init({client_id:a,environment:b,redirect_uri:c,http_function:e,deferred_function:f.defer,timeout_function:g,save_access_token:!0,auto_expire:!0,auto_signin:!1,expire_callback:function(){h.$emit("sessionExpired")}}),d.FamilySearch.Person.prototype._isMale=function(){return this.gender&&"http://gedcomx.org/Male"===this.gender.type},d.FamilySearch}]}),angular.module("recordseekApp").directive("fsReAuthenticate",["$rootScope","fsReAuthenticateModal",function(a,b){return{template:"<div></div>",link:function(c){var d=a.$on("sessionExpired",function(){b.open()});c.$on("$destroy",d)}}}]),angular.module("recordseekApp").directive("fsReAuthenticate",["$rootScope","fsReAuthenticateModal",function(a,b){return{template:"<div></div>",link:function(c){var d=a.$on("sessionExpired",function(){b.open()});c.$on("$destroy",d)}}}]),angular.module("recordseekApp").factory("fsReAuthenticateModal",["$modal","$rootScope","fsApi",function(a,b,c){return{open:function(){return a.open({templateUrl:"views/fsReAuthenticateModal.html",size:"sm",controller:["$scope",function(a){a.signin=function(){a.$close(),c.getAccessToken().then(function(){b.$emit("newSession")})}}]}).result}}}]),angular.module("recordseekApp").controller("ASourceCtrl",["$rootScope","$location","$scope","$window",function(a,b,c,d){a.service="Ancestry",c.goNext=function(){$cookie.remove("recordseek");var b="http://trees.ancestry.com/savetoancestry?o_sch=Web+Property";a.data.url&&(b+="&url="+encodeURIComponent(a.data.url)),a.data.domain&&(b+="&domain="+encodeURIComponent(a.data.domain)),a.data.title&&(b+="&collection="+encodeURIComponent(a.data.title)),a.data.citation&&(b+="&details="+encodeURIComponent(a.data.citation)),d.location.href=b},c.goBack=function(){a.service="",b.path("/")}}]),angular.module("recordseekApp").controller("FsResultsCtrl",["$rootScope","$location","$scope",function(a,b,c){}]),angular.module("recordseekApp").service("rsData",function(){}),angular.module("recordseekApp").factory("fsCurrentUserCache",["$q","$rootScope","fsAPI",function(a,b,c){var d=null;return b.$on("newSession",function(){d=null}),{getUser:function(){return d?a.when(d):c.getCurrentUser().then(function(a){return d=a.getUser()})}}}]);